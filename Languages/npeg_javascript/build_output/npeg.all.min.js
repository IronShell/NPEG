if(!RobustHaven){var RobustHaven={};}if(!RobustHaven.Text){RobustHaven.Text={};}if(!RobustHaven.Text.Npeg){RobustHaven.Text.Npeg={};}RobustHaven.Text.Npeg.extend=function(a,c){var b=function(){};b.prototype=c.prototype;a.prototype=new b();a.prototype.constructor=a;a.superclass=c.prototype;};RobustHaven.Text.Npeg.stringToBytes=function(e){var a,d,c=[];for(var b=0;b<e.length;b++){a=e.charCodeAt(b);d=[];do{d.push(a&255);a=a>>8;}while(a);c=c.concat(d.reverse());}return c;};if(!RobustHaven){var RobustHaven={};}if(!RobustHaven.Text){RobustHaven.Text={};}if(!RobustHaven.Text.Npeg){RobustHaven.Text.Npeg={};}RobustHaven.Text.Npeg.ParsingExpressionGrammarException=function(a){this.toString=function(){return a;};this.getMessage=function(){return a;};};if(!RobustHaven){var RobustHaven={};}if(!RobustHaven.Text){RobustHaven.Text={};}if(!RobustHaven.Text.Npeg){RobustHaven.Text.Npeg={};}RobustHaven.Text.Npeg.ParsingFatalTerminalException=function(b,c){var a=c,b=(typeof b==undefined)?"":b;RobustHaven.Text.Npeg.ParsingFatalTerminalException.superclass.constructor.call(this,b);this.getErrorPosition=function(){return a;};};RobustHaven.Text.Npeg.extend(RobustHaven.Text.Npeg.ParsingFatalTerminalException,RobustHaven.Text.Npeg.ParsingExpressionGrammarException);if(!RobustHaven){var RobustHaven={};}if(!RobustHaven.Text){RobustHaven.Text={};}if(!RobustHaven.Text.Npeg){RobustHaven.Text.Npeg={};}RobustHaven.Text.Npeg.InfiniteLoopException=function(a,b){var a=(typeof a=="undefined")?"Supplied grammar rules caused an infinite loop.":a;RobustHaven.Text.Npeg.InfiniteLoopException.superclass.constructor.call(this,a,b);};RobustHaven.Text.Npeg.extend(RobustHaven.Text.Npeg.InfiniteLoopException,RobustHaven.Text.Npeg.ParsingFatalTerminalException);if(!RobustHaven){var RobustHaven={};}if(!RobustHaven.Text){RobustHaven.Text={};}if(!RobustHaven.Text.Npeg){RobustHaven.Text.Npeg={};}RobustHaven.Text.Npeg.InputIterator=function(a){this.index=0;this.length=a;this.getIndex=function(){return this.index;};this.setIndex=function(b){this.index=b;};this.getLength=function(){return this.length;};this.getText=null;this.getCurrent=null;this.getNext=null;this.getPrevious=null;};if(!RobustHaven){var RobustHaven={};}if(!RobustHaven.Text){RobustHaven.Text={};}if(!RobustHaven.Text.Npeg){RobustHaven.Text.Npeg={};}RobustHaven.Text.Npeg.StringInputIterator=function(a,b){var b=(b==undefined)?a.length:b;RobustHaven.Text.Npeg.StringInputIterator.superclass.constructor.call(this,b);this.input=a;this.getText=function(g,d){var f=d-g,c=new Array();if(this.input.length==0||d<g){return null;}for(var e=0;e<f;e++){if(this.input[g+e]!=undefined){c[e]=this.input[g+e];}}return c;};this.getTextString=function(f,d){var c=this.getText(f,d),g="";for(var e=0;e<c.length;e++){g+=c[e];}return g;};this.getCurrent=function(){if(this.index>=this.length){return -1;}else{return this.input[this.index];}};this.getNext=function(){if(this.index>=this.length){return -1;}else{this.index+=1;if(this.index>=this.length){return -1;}else{return this.input[this.index];}}};this.getPrevious=function(){if(this.index<=0){return -1;}else{if(this.length<=0){throw"Error";}this.index-=1;return this.input[this.index];}};};RobustHaven.Text.Npeg.StringInputIterator.stringToBytes=function(e){var a,d,c=[];for(var b=0;b<e.length;b++){a=e.charCodeAt(b);d=[];do{d.push(a&255);a=a>>8;}while(a);c=c.concat(d.reverse());}return c;};RobustHaven.Text.Npeg.extend(RobustHaven.Text.Npeg.StringInputIterator,RobustHaven.Text.Npeg.InputIterator);if(!RobustHaven){var RobustHaven={};}if(!RobustHaven.Text){RobustHaven.Text={};}if(!RobustHaven.Text.Npeg){RobustHaven.Text.Npeg={};}var Expression=function(){this.npeg=null;this.evaluate=function(){};};if(!RobustHaven){var RobustHaven={};}if(!RobustHaven.Text){RobustHaven.Text={};}if(!RobustHaven.Text.Npeg){RobustHaven.Text.Npeg={};}RobustHaven.Text.Npeg.TokenMatch=function(b,c,a){var b=b,c=c,a=a;this.getName=function(){return b;};this.setName=function(d){b=d;};this.getStart=function(){return c;};this.setStart=function(d){c=d;};this.getEnd=function(){return a;};this.setEnd=function(d){a=d;};};if(!RobustHaven){var RobustHaven={};}if(!RobustHaven.Text){RobustHaven.Text={};}if(!RobustHaven.Text.Npeg){RobustHaven.Text.Npeg={};}RobustHaven.Text.Npeg.AstNode=function(c){var c=c,a=[],b;this.children=new Array();this.getParent=function(){return b;};this.setParent=function(d){b=d;};this.getChildren=function(){return a;};this.addChild=function(d){a[a.length]=d;};this.getToken=function(){return c;};this.setToken=function(d){c=d;};this.accept=function(g){g.visitEnter(this);var e=true;for(var d=0;d<a;d++){var f=a[d];if(!e){g.visitExecute(this);}e=false;f.accept(g);}g.visitLeave(this);};};if(!RobustHaven){var RobustHaven={};}if(!RobustHaven.Text){RobustHaven.Text={};}if(!RobustHaven.Text.Npeg){RobustHaven.Text.Npeg={};}RobustHaven.Text.Npeg.Warn=function(a,b){var a=(a!=undefined)?a:"",b=(b!=undefined)?b:null;this.getMessage=function(){return a;};this.setMessage=function(c){a=c;};this.getPosition=function(){return b;};this.setPosition=function(c){b=c;};};if(!RobustHaven){var RobustHaven={};}if(!RobustHaven.Text){RobustHaven.Text={};}if(!RobustHaven.Text.Npeg){RobustHaven.Text.Npeg={};}RobustHaven.Text.Npeg.Npeg=function(d){var f=[],h=[],e={},i=[],g=d;var a=function(l){throw new RobustHaven.Text.Npeg.ParsingFatalTerminalException(l,g.getIndex());};var k=function(p,l){var o=255,q=0,m;for(m=0;m<2;m++){q=q<<4;if(l[m]>="0".charCodeAt(0)&&l[m]<="9".charCodeAt(0)){q=q+(l[m]-"0".charCodeAt(0));}else{var n=String.fromCharCode(l[m]).toLowerCase().charCodeAt(0);if(n>="a".charCodeAt(0)&&n<="f".charCodeAt(0)){q+=(n-"a".charCodeAt(0)+10);}else{if(n=="x".charCodeAt(0)){if(m==0){o=o&15;}else{o=o&240;}}else{return -1;}}}}p[0]=o;return q;};var j=function(o,l){var n=0,p=0,m;for(m=0;m<8;m++){p=p<<1;n=n<<1;if(l[m]=="0".charCodeAt(0)||l[m]=="1".charCodeAt(0)){p=p+(l[m]-"0".charCodeAt(0));n=n|1;}else{if(l[m]=="x".charCodeAt(0)||l[m]=="X".charCodeAt(0)){}else{return -1;}}}o[0]=n;return p;};var b=function(l){return l.getCurrent().charCodeAt(0)&255;};this.getAST=function(){if(h.length>0&&h[h.length-1].length>0){return h[h.length-1].pop();}else{return null;}};this.getWarnings=function(){return i;};this.isMatch=function c(){try{}catch(l){throw l;}};this._disableBackReferencePushOnStack=function(l){f[f.length]=l;};this.andPredicate=function(l){var m,n=g.getIndex();this._disableBackReferencePushOnStack(true);m=l.evaluate();g.setIndex(n);f.pop();return m;};this.notPredicate=function(l){var m,n=g.getIndex();this._disableBackReferencePushOnStack(true);m=!l.evaluate();g.setIndex(n);f.pop();return m;};this.prioritizedChoice=function(l,m){var n;n=g.getIndex();if(l.evaluate()){return true;}g.setIndex(n);if(m.evaluate()){return true;}g.setIndex(n);return false;};this.sequence=function(l,m){var n=g.getIndex();if(l.evaluate()&&m.evaluate()){return true;}else{g.setIndex(n);return false;}};this.zeroOrMore=function(l){var n=g.getIndex();while(l.evaluate()){if(n==g.getIndex()){var m="Infinite loop detected in limitingRepetition.\n";m+="Grammar Expression: "+grammarExpression;throw new RobustHaven.Text.Npeg.InfiniteLoopException(m,g.getIndex());}n=g.getIndex();}g.setIndex(n);return true;};this.oneOrMore=function(m,n){var l=0,p=g.getIndex();while(m.evaluate()){if(p==g.getIndex()){var o="Infinite loop detected in limitingRepetition.\n";o+="Grammar Expression: "+n;throw new RobustHaven.Text.Npeg.InfiniteLoopException(o,g.getIndex());}p=g.getIndex();l++;}g.setIndex(p);return(l>0);};this.optional=function(l){var m=g.getIndex();if(l.evaluate()){m=g.getIndex();}else{g.setIndex(m);}return true;};this.limitingRepetition=function(q,p,m,n){var l=0,t,o,s=false;o=t=g.getIndex();if(q>p&&p!=-1){a("Repetition bounds invalid: min > max");}if(q==-1&&p==-1){a("Neither an upper nor a lower bound specified, please use zeroOrMore");}if(q!=-1){if(p==-1){t=g.getIndex();while(m.evaluate()){if(t==g.getIndex()){var r="Infinite loop detected in limitingRepetition.\n";r+="Grammar Expression: "+n;throw new RobustHaven.Text.Npeg.InfiniteLoopException(r,g.getIndex());}l++;t=g.getIndex();}g.setIndex(t);s=(l>=q);}else{t=g.getIndex();while(m.evaluate()){l++;t=g.getIndex();if(l>=p){break;}}g.setIndex(t);s=(l<=p&&l>=q);}}else{t=g.getIndex();while(m.evaluate()){l++;t=g.getIndex();if(l>=p){break;}}g.setIndex(t);s=(l<=p);}if(s==false){g.setIndex(o);}return s;};this.recursionCall=function(m){try{}catch(l){throw l;}};this.capturingGroup=function(q,r,p,l){var s=true,u=g.getIndex(),t=[],n;t=(h[h.length-1]!=undefined)?h[h.length-1]:[];n=new RobustHaven.Text.Npeg.AstNode(null);t[t.length]=n;if(h.length>0){h[h.length-1]=t;}else{h[0]=t;}if(q.evaluate()){var m,o,v=[];o=g.getText(u,g.getIndex());v=e[r];if(v==undefined){v=[];v[v.length]=o;e[r]=v;}m=t[t.length-1];t.pop();m.setToken(new RobustHaven.Text.Npeg.TokenMatch(r,u,g.getIndex()));if(l){throw"@todo: Npeg.capturingGroup - create a custom astnode";}if(p){if(m.getChildren().length==1){m=m.getChildren()[0];}}if(t.length>0){m.setParent(t[t.length-1]);m.getParent().addChild(m);}else{t[t.length]=m;}u=g.getIndex();s&=true;}else{t.pop();g.setIndex(u);s&=false;}return s;};this.codePoint=function(s,t){var s=(typeof s!="object"&&!(s instanceof Array))?RobustHaven.Text.Npeg.StringInputIterator.stringToBytes(""+s):s;if(s[0]!="#".charCodeAt(0)){a('Input string not in format "#[x,b]<CODE><CODE>..."');}else{var z,o,x=g.getIndex(),l=[0],r=[];if(s[1]=="x".charCodeAt(0)){o=2;if(o==t){a("Hex value specified is empty.");}else{if(t%2==1){var y=[];y[0]="0".charCodeAt(0);y[1]=s[o];z=k(l,y);if(z==-1){a("Hex value specified contains invalid byteacters.");}else{if(g.getIndex()>=g.getLength()||(l[0]&b(g))!=z){g.setIndex(x);return false;}}o++;g.getNext();}}for(;o<t;o+=2){r[0]=s[o];r[1]=s[o+1];z=k(l,r);if(z==-1){a("Hex value specified contains invalid byteacters.");}else{if(g.getIndex()>=g.getLength()||(l[0]&b(g))!=z){g.setIndex(x);return false;}}g.getNext();}return true;}else{if(s[1]=="b".charCodeAt(0)){o=2;r=[];if(o==t){a("Binary value specified is empty.");}else{if((t-o)%8!=0){var n,w,q;n=(t-o)%8;w=8-n;for(q=0;q<w;q++){r[q]="0".charCodeAt(0);}for(q=0;q<n;q++){r[q+w]=s[o+q];}z=j(l,r);if(z==-1){a("Binary value specified contains invalid byteacters.");}else{if(g.getIndex()>=g.getLength()||(l[0]&b(g))!=z){g.setIndex(x);return false;}}o+=n;g.getNext();}}for(;o<t;o+=8){var q;for(q=0;q<8;q++){r[q]=s[o+q];}z=j(l,r);if(z==-1){a("Binary value specified contains invalid byteacters.");}else{if(g.getIndex()>=g.getLength()||(l[0]&b(g))!=z){g.setIndex(x);return false;}}g.getNext();}return true;}else{var m=0,u,v,p,o=1;m=0;for(;o<t;o++){if(s[o]>="0".charCodeAt(0)&&s[o]<="9".charCodeAt(0)){m=m*10;m=m+(s[o]-"0".charCodeAt(0));}else{a("Decimal value specified contains invalid byteacters.");}}if(m>Number.MAX_VALUE){a("Decimal codepoint value exceeds 4 byte maximum length. Largest decimal value possible 2^31 - 1");}else{if(m==0){m=48;}}u=m;if(u>>>24!=0){v=4;}else{if(u>>>16!=0){v=3;}else{if(u>>>8!=0){v=2;}else{v=1;}}}if(v>(g.getLength()-g.getIndex())){return false;}p=0;for(o=0;o<v;o++){p=(p<<8)+b(g);g.getNext();}if(p!=u){g.setIndex(x);return false;}else{return true;}}}}};this.anyCharacter=function(){var l;if(g.getIndex()<g.getLength()){g.getNext();l=true;}else{l=false;}return l;};this.characterClass=function(l,m){var w=false,v=0,x=false,n=g.getCurrent(),u=true,o=new String("CharacterClass definition must be a minimum of 3 characters [expression]"),p=new String("CharacterClass definition must start with ["),q=new String("CharacterClass definition must end with ]"),r=new String("CharacterClass definition requires user to escape '\\' given location in expression. User must escape by specifying '\\\\'"),s=new String("CharacterClass definition requires user to escape '-' given location in expression. User must escape by specifying '\\-'"),t=new String("CharacterClass definition contains an invalid escape sequence. Accepted sequences: \\\\, \\s, \\S, \\d, \\D, \\w, \\W");if(n==-1){return false;}if(m<3){a(o);}if(l[v]!="["){a(p);}if(l[m-1]!="]"){a(q);}v++;if(l[v]=="^"){u=false;v++;}v--;while(++v<m){if(l[v]=="\\"){if(x==true){x=false;if(n=="\\"){w=true;}}else{x=true;if((v+1)>=(m-1)){a(r);}}}else{if(l[v]=="-"){if(x==true){x=false;if(n==l[v]){w=true;}}else{if((v-1)==0){a(s);}else{if((v+1)>=(m-1)){a(s);}else{if(n>=l[v-1]&&n<=l[v+1]){w=true;}}}}}else{if(x==true){x=false;switch(l[v]){case"d":if(n>="0"&&n<="9"){w=true;}break;case"D":if(!(n>="0"&&n<="9")){w=true;}break;case"s":if(n==" "||n=="\f"||n=="\n"||n=="\r"||n=="\t"){w=true;}break;case"S":if(!(n==" "||n=="\f"||n=="\n"||n=="\r"||n=="\t")){w=true;}break;case"w":if((n>="a"&&n<="z")||(n>="A"&&n<="Z")||(n>="0"&&n<="9")||n=="_"){w=true;}break;case"W":if(!((n>="a"&&n<="z")||(n>="A"&&n<="Z")||(n>="0"&&n<="9")||n=="_")){w=true;}break;default:a(t);}}else{if(n==l[v]){w=true;}}}}}if(!u){w=(true==w)?false:true;}if(w){g.getNext();}return w;};this.literal=function(o,p,n){var q=g.getIndex();for(var m=0;m<p;m++){var l=g.getCurrent();if(l==-1){g.setIndex(q);return false;}if(n){if(l!=o[m]){g.setIndex(q);return false;}}else{if(l.toUpperCase()!=o[m].toUpperCase()){g.setIndex(q);return false;}}g.getNext();}return true;};this.dynamicBackReference=function(m,n){try{}catch(l){throw l;}};this.fatal=function(l){return a(l);return false;};this.warn=function(l){i[i.length]=new RobustHaven.Text.Npeg.Warn(l,g.getIndex());return true;};};